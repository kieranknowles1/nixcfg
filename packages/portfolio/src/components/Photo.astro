---
import type { ImageMetadata } from "astro"
import { Picture } from "astro:assets"
import { Icon } from "astro-icon/components"
import meta from '../../exif.json'

import "../styles/photo.css"

interface Props {
  img: ImageMetadata,
  description: string,
  eager?: boolean,
  orientation: 'portrait' | 'landscape' | 'square' | 'smallsquare' | 'ultrawide',
  rescale?: number
}

const {
  img,
  description,
  eager = false,
  orientation,
  rescale = 0.2,
} = Astro.props;

const filename = img.src.match(/\/([a-z0-9]{32}-)?([a-z-]*)[.]/)?.at(2)
const filemeta = meta.filter(
  e => filename && e.FileName.startsWith(filename)
).at(0)
if (filemeta == undefined) throw new Error("Failed to get file metadata")

---
<article class={`${orientation} photo`}>
  <Picture
    src={img} alt={description}
    loading={eager ? 'eager' : 'lazy'}
    width={img.width * rescale}
    height={img.height * rescale}
  />
  <span class="photometa">
    <Icon name="mdi:timer" title="Exposure Time"/>{filemeta.ExposureTime}s
    <Icon name="mdi:magnify-plus" title="Focal Length"/>{filemeta.FocalLength}
    <Icon name="bx:aperture" title="Aperture"/>{filemeta.Aperture}
  </span>
</article>
