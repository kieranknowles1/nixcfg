---
import type { ImageMetadata } from "astro"
import { Picture } from "astro:assets"
import { Icon } from "astro-icon/components"
import meta from '../../exif.json'

interface Props {
  img: ImageMetadata,
  description: string,
  eager?: boolean,
  orientation?: 'portrait' | 'landscape',
  rescale?: number
}

const {
  img,
  description,
  eager = false,
  orientation = 'landscape',
  rescale = 0.2,
} = Astro.props;

const filename = img.src.match(/\/([a-z-]*)[.]/)?.at(1)
const filemeta = meta.filter(
  e => filename && e.FileName.startsWith(filename)
).at(0)
if (filemeta == undefined) throw new Error("Failed to get file metadata")

// TODO: Display ISO, focal length, aperture, and exposure time
// TODO: Click for larger version
// TODO: Display description when clicked
---
<article class={orientation}>
  <Picture
    src={img} alt={description}
    loading={eager ? 'eager' : 'lazy'}
    width={img.width * rescale}
    height={img.height * rescale}
  />
  <!-- TODO: Overlay this on the image -->
  <p>
    <Icon name="mdi:timer" title="Exposure"/>{filemeta.ExposureTime}s
    <Icon name="mdi:magnify-plus" title="Focal Length"/>{filemeta.FocalLength}
    <Icon name="bx:aperture" title="Aperture"/>{filemeta.Aperture}
  </p>
</article>
